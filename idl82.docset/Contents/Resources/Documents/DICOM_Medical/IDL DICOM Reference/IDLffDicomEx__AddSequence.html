<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:madcap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" madcap:lastblockdepth="2" madcap:lastheight="135.6667" madcap:lastwidth="592" madcap:disablemasterstylesheet="true" madcap:tocpath="Additional Topics|Medical Imaging in IDL|IDL DICOM Reference|IDLffDicomEx" madcap:medium="non-print" madcap:inpreviewmode="false" madcap:preloadimages="false" madcap:runtimefiletype="Topic" madcap:targettype="WebHelp" lang="en-US" xml:lang="en-US" madcap:pathtohelpsystem="../../../" madcap:helpsystemfilename="idl.xml" madcap:searchtype="Stem">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
   IDLffDicomEx::AddSequence
  </title>
  <link href="../../SkinSupport/MadCap.css" rel="stylesheet" />
  <link href="../../Resources/TableStyles/VersionTable.css" rel="stylesheet" />
  <link href="../../Resources/Stylesheets/IDL_style.css" rel="stylesheet" />
  <script src="../../SkinSupport/MadCapAll.js" type="text/javascript">
  </script>
 </head>
 <body>
  <p class="MCWebHelpFramesetLink" style="display: none;">
   <a href="../../../idl_CSH.html#DICOM_Medical/IDL DICOM Reference/IDLffDicomEx__AddSequence.html" style="">
    Open topic with navigation
   </a>
  </p>
  <div class="MCBreadcrumbsBox_0">
   <span class="MCBreadcrumbsPrefix">
    <![CDATA[ ]]>
   </span>
   <a class="MCBreadcrumbsLink" href="../../OtherTopics.html">
    Additional Topics
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="../Expanded DICOM Support in IDL/ExpandedDICOMFunctionality.html">
    Medical Imaging in IDL
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="DICOMEX_GETCONFIGFILEPAT.html">
    IDL DICOM Reference
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <span class="MCBreadcrumbs">
    IDLffDicomEx::AddSequence
   </span>
  </div>
  <h1 class="ObjMethod">
   IDLffDicomEx::AddSequence
  </h1>
  <p>
   The IDLffDicomEx::AddSequence function method creates a new sequence. The DicomTag argument specifies a sequence (SQ) attribute, which must be part of the standard IOD (Information Object Definition) for the DICOM file type (unless the NON_CONFORMING keyword was set when the IDLffDicomEx object was created using the
   <a href="IDLffDicomEx__Init.html">
    IDLffDicomEx::Init
   </a>
   method).
  </p>
  <p>
   The optional PARENTSEQID keyword can be used to create a nested sequence, placing the new sequence within an existing sequence. This existing sequence is identified by a sequence identifier, which may have been returned by a previous call to IDLffDicomEx::AddSequence or
   <a href="IDLffDicomEx__GetValue.html">
    IDLffDicomEx::GetValue
   </a>
   .
  </p>
  <p>
   Once the sequence has been created, member items can be added via the IDLffDicomEx::SetValue method using the return value from this method, the identifier of the new sequence.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   Changes are not written to the DICOM file until you call the
   <a href="IDLffDicomEx__Commit.html" class="MCXref_0">
    IDLffDicomEx::Commit
   </a>
   method. When you commit changes, all sequence identifiers are invalidated. You need to call
   <a href="IDLffDicomEx__GetValue.html" class="MCXref_0">
    IDLffDicomEx::GetValue
   </a>
   to re-access the sequence identifiers. See
   <a href="IDLffDicomEx__AddGroup.html" class="MCXref_0">
    IDLffDicomEx::AddGroup
   </a>
   for an example.
  </p>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1006886">
   </a>
   <a name="dicom_ex_4010397576_1006886_PageTOC_IDLffDicomEx">
   </a>
   Syntax
  </h2>
  <p class="Syntax">
   <span class="Italic">
    Result
   </span>
   =
   <span class="Italic">
    Obj
   </span>
   -&gt;[
   <a href="IDLffDicomEx.html" class="MCXref_0">
    IDLffDicomEx
   </a>
   ::]AddSequence (
   <span class="Italic">
    DicomTag
   </span>
   [,&#160;
   <a href="#dicom_ex_4010397576_1006906" class="MCXref_0">
    PARENTSEQID
   </a>
   =
   <span class="Italic">
    integer
   </span>
   ]&#160;)
  </p>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1006888">
   </a>
   <a name="dicom_ex_4010397576_1006888_PageTOC_IDLffDicomEx">
   </a>
   Return Value
  </h2>
  <p>
   Returns a long integer containing the sequence identifier for the newly created sequence. This identifier can be used by other methods that use the SEQID keyword such as
   <a href="IDLffDicomEx__GetValue.html" class="MCXref_0">
    IDLffDicomEx::GetValue
   </a>
   and
   <a href="IDLffDicomEx__SetValue.html" class="MCXref_0">
    IDLffDicomEx::SetValue
   </a>
   methods.
  </p>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1006896">
   </a>
   <a name="dicom_ex_4010397576_1006896_PageTOC_IDLffDicomEx">
   </a>
   Arguments
  </h2>
  <h3 class="Argument">
   DicomTag
  </h3>
  <p>
   A string that identifies the group and element of a DICOM sequence (SQ) attribute in the form
   <span class="Courier">
    'XXXX,XXXX'
   </span>
   . The
   <span class="Italic">
    DicomTag
   </span>
   argument must reference a public tag that is part of the standard IOD for the image type and must be of the SQ VR type. See
   <a href="../DICOM Resources/DICOMAttributes.html">
    DICOM Attributes
   </a>
   for a list of tags.
  </p>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1006905">
   </a>
   <a name="dicom_ex_4010397576_1006905_PageTOC_IDLffDicomEx">
   </a>
   Keywords
  </h2>
  <h3 class="Keyword">
   <a name="dicom_ex_4010397576_1006906">
   </a>
   <a name="dicom_ex_4010397576_1006906_Keywords_IDLffDicomEx">
   </a>
   PARENTSEQID
  </h3>
  <p>
   Set this keyword only if adding the new sequence to an existing sequence. Use this keyword to specify a parent sequence identifier to add the sequence to as follows:
  </p>
  <ul>
   <li value="1">
    If set to a non-zero value (a sequence identifier), then the sequence will be added to the existing, specified sequence. This sequence identifier may have been returned via a previous call to the IDLffDicomEx::AddSequence method.
   </li>
   <li value="2">
    If set to 0 or not specified, then the sequence is added to the root level of the DICOM file. This is the default.
   </li>
  </ul>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1033339">
   </a>
   <a name="dicom_ex_4010397576_1033339_PageTOC_IDLffDicomEx">
   </a>
   Example
  </h2>
  <p>
   The following example adds a sequence to the root-level of a cloned DICOM file and, a nested sequence containing attributes within the first sequence. The NON_CONFORMING keyword is set when the clone is created in order to avoid errors encountered when attempting to add non-standard attributes to the selected DICOM file. The newly added attributes are printed to the IDL Output Log window.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   For an example that adds groups of repeating tags to a sequence, see the “Examples” section of
   <a href="IDLffDicomEx__AddGroup.html" class="MCXref_0">
    IDLffDicomEx::AddGroup
   </a>
   .
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   This example does not write the cloned file to memory. To do so, simply use the
   <a href="IDLffDicomEx__Commit.html" class="MCXref_0">
    IDLffDicomEx::Commit
   </a>
   method.
  </p>
  <p class="Code">
   PRO dicom_addpublicattributes_doc
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Select a DICOM file.
  </p>
  <p class="Code">
   sFile = DIALOG_PICKFILE($
  </p>
  <p class="Code">
   PATH=FILEPATH('',SUBDIRECTORY=['examples','data']), $
  </p>
  <p class="Code">
   TITLE='Select DICOM Patient File', FILTER='*.dcm', $
  </p>
  <p class="Code">
   GET_PATH=path)
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Create a clone (aImgClone.dcm) of the selected file (sfile).
  </p>
  <p class="Code">
   ; Set the NON_CONFORMING keyword to be able to add a public SQ
  </p>
  <p class="Code">
   ; of radiopharmaceutical items to any file.
  </p>
  <p class="Code">
   oImg = OBJ_NEW('IDLffDicomEx', path + 'aImgClone.dcm', $
  </p>
  <p class="Code">
   CLONE=sfile, /NON_CONFORMING)
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Add a root-level sequence (Radiopharmaceutical Information).
  </p>
  <p class="Code">
   ; **********************************************************
  </p>
  <p class="Code">
   vRootSeq = oImg-&gt;AddSequence('0054,0016')
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Add an attribute within the sequence.
  </p>
  <p class="Code">
   ; *************************************
  </p>
  <p class="Code">
   oImg-&gt;SetValue, '0018,1071', 'DS', '0', SEQID=vRootSeq
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Add a nested sequence (Radionuclide Code Sequence).
  </p>
  <p class="Code">
   ; ***************************************************
  </p>
  <p class="Code">
   vNestSeq = oImg-&gt;AddSequence('0054,0300', PARENTSEQID=vRootSeq)
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Add two items to the nested sequence.
  </p>
  <p class="Code">
   ;**************************************
  </p>
  <p class="Code">
   oImg-&gt;SetValue, '0008,0100', 'SH', 'Tc-99m', SEQID=vNestSeq
  </p>
  <p class="Code">
   oImg-&gt;SetValue, '0008,0102', 'SH', '99SDM', SEQID=vNestSeq
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Print a range including the new tags to
  </p>
  <p class="Code">
   ; the Output Log window.
  </p>
  <p class="Code">
   vTags = oImg-&gt;EnumerateTags(COUNT=vTagCnt, $
  </p>
  <p class="Code">
   START_TAG='0054,0000', STOP_TAG='0056,0000')
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Format the output.
  </p>
  <p class="Code">
   PRINT, FORMAT= $
  </p>
  <p class="Code">
   '(%"%-12s, %3s, %5s, %31s, %10s")', $
  </p>
  <p class="Code">
   'TAG',  'VR', 'SEQID', $
  </p>
  <p class="Code">
   'DESCRIPTION', 'VALUE'
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Cycle through the tags.
  </p>
  <p class="Code">
   FOR xx = 0, vTagCnt-1  DO BEGIN
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; If the item is nested within another item, indicate the
  </p>
  <p class="Code">
   ; level using &gt; symbol.
  </p>
  <p class="Code">
   IF (vTags[xx].Level GT 0) THEN BEGIN
  </p>
  <p class="Code">
   &#160;&#160;&#160;&#160;&#160;&#160;vLvl = STRJOIN(REPLICATE('&gt;',vTags[xx].Level))
  </p>
  <p class="Code">
   vtg =  vLvl + vTags[xx].Tag
  </p>
  <p class="Code">
   ENDIF ELSE BEGIN
  </p>
  <p class="Code">
   vtg = vTags[xx].Tag
  </p>
  <p class="Code">
   ENDELSE
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; If the tags are in a group, indicate this.
  </p>
  <p class="Code">
   IF (vTags[xx].GroupNum GT 0) THEN BEGIN
  </p>
  <p class="Code">
   PRINT, FORMAT='(%"%15s, %1d")', 'Group', vTags[xx].GroupNum
  </p>
  <p class="Code">
   ENDIF
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Print the fields of the structure.
  </p>
  <p class="Code">
   PRINT, FORMAT = $
  </p>
  <p class="Code">
   '(%"%-12s, %3s, %5d, %31s, %10s")', $
  </p>
  <p class="Code">
   vtg, vTags[xx].VR, vTags[xx].SeqId, $
  </p>
  <p class="Code">
   vTags[xx].Description, vTags[xx].Value
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ENDFOR
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   ; Clean up references.
  </p>
  <p class="Code">
   OBJ_DESTROY, oImg
  </p>
  <p class="Code">
   &#160;
  </p>
  <p class="Code">
   END
  </p>
  <p>
   Running this example generates the following output.
  </p>
  <p class="Code">
   TAG         ,  VR, SEQID,                     DESCRIPTION,  &#160;&#160;VALUE
  </p>
  <p class="Code">
   0054,0016   ,  SQ,   337, Radiopharmaceutical Information,
  </p>
  <p class="Code">
   &gt;0018,1071  ,  DS,   338,      Radiopharmaceutical Volume, &#160;&#160;&#160;&#160;&#160;&#160;&#160;0
  </p>
  <p class="Code">
   &gt;0054,0300  ,  SQ,   338,      Radionuclide Code Sequence,
  </p>
  <p class="Code">
   &gt;&gt;0008,0100 ,  SH,   339,                      Code Value, &#160;&#160;Tc-99m
  </p>
  <p class="Code">
   &gt;&gt;0008,0102 ,  SH,   339,        Coding Scheme Designator, &#160;&#160;&#160;99SDM
  </p>
  <h2 class="API">
   <a name="dicom_ex_4010397576_1036854">
   </a>
   <a name="dicom_ex_4010397576_1036854_PageTOC_IDLffDicomEx">
   </a>
   Version History
  </h2>
  <table style="width: 499px;caption-side: top;mc-table-style: url('../../Resources/TableStyles/VersionTable.css');" cellspacing="0" class="TableStyle_VersionTable">
   <col width="91px" />
   <col width="408px" />
   <tbody>
    <tr>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColSep">
      <p>
       6.1
      </p>
     </td>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColEnd">
      <p>
       Introduced
      </p>
     </td>
    </tr>
   </tbody>
  </table>
  <div class="mp_footer">
   Copyright ©
   <span class="DocumentTitleCopyrightYear">
    2012
   </span>
   <![CDATA[ ]]>
   <span class="DocumentTitleCopyrightCompanyName">
    Exelis Visual Information Solutions, Inc.
   </span>
   All Rights Reserved.
  </div>
  <script type="text/javascript" src="../../SkinSupport/MadCapBodyEnd.js">
  </script>
 </body>
</html>