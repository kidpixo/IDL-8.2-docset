<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:madcap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" madcap:lastblockdepth="2" madcap:lastheight="135.6667" madcap:lastwidth="592" madcap:disablemasterstylesheet="true" madcap:tocpath="Routines (alphabetical)|Routines: V" madcap:medium="non-print" madcap:inpreviewmode="false" madcap:preloadimages="false" madcap:runtimefiletype="Topic" madcap:targettype="WebHelp" lang="en-US" xml:lang="en-US" madcap:pathtohelpsystem="../../../" madcap:helpsystemfilename="idl.xml" madcap:searchtype="Stem">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
   VOXEL_PROJ
  </title>
  <link href="../../SkinSupport/MadCap.css" rel="stylesheet" />
  <link href="../../Resources/TableStyles/VersionTable.css" rel="stylesheet" />
  <link href="../../Resources/Stylesheets/IDL_style.css" rel="stylesheet" />
  <script src="../../SkinSupport/MadCapAll.js" type="text/javascript">
  </script>
 </head>
 <body>
  <p class="MCWebHelpFramesetLink" style="display: none;">
   <a href="../../../idl_CSH.html#Reference Material/V/VOXEL_PROJ.html" style="">
    Open topic with navigation
   </a>
  </p>
  <div class="MCBreadcrumbsBox_0">
   <span class="MCBreadcrumbsPrefix">
    <![CDATA[ ]]>
   </span>
   <a class="MCBreadcrumbsLink" href="../../images/ref_part1.html">
    Routines (alphabetical)
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="V_list.html">
    Routines: V
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <span class="MCBreadcrumbs">
    VOXEL_PROJ
   </span>
  </div>
  <h1 class="Routine">
   <a name="dg_routines_3604229493_889793">
   </a>
   <a name="dg_routines_3604229493_99427">
   </a>
   VOXEL_PROJ
  </h1>
  <p madcap:conditions="Direct Graphics.Online_Help_Only">
   <madcap:conditionaltext madcap:conditions="Direct Graphics.Online_Help_Only">
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889827">
     Syntax
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889857">
     Return Value
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889860">
     Arguments
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889869">
     Keywords
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889901">
     Examples
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889918">
     Version History
    </a>
    |
    <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889926">
     See Also
    </a>
   </madcap:conditionaltext>
  </p>
  <p>
   The
   <a name="kanchor2682">
   </a>
   VOXEL_PROJ function generates
   <a name="kanchor2683">
   </a>
   visualizations of volumetric data by computing 2-D projections of a colored, semi-transparent volume. Parallel rays from any given direction are cast through the volume, onto the viewing plane. User-selected colors and opacities can be assigned to arbitrary data ranges, simulating the appearance of the materials contained within the volume.
  </p>
  <p>
   The VOXEL_PROJ function can be combined with the Z-buffer to render volume data over objects. Cutting planes can also be specified to view selected portions of the volume. Other options include: selectable resolution to allow quick “preview” renderings, and average and maximum projections.
  </p>
  <p>
   VOXEL_PROJ renders volumes using an algorithm similar to the one described by Drebin, Carpenter, and Hanrahan, in “Volume Rendering”,
   <i>
    Computer Graphics
   </i>
   , Volume 22, Number 4, August 1988, pp. 125-134, but without the surface extraction and enhancement step.
  </p>
  <p>
   Voxel rendering can be quite time consuming. The time required to render a volume is proportional to the viewing areas size, in pixels, times the thickness of the volume cube in the viewing direction, divided by the product of the user-specified X, Y, and Z steps.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   It is necessary to use SCALE3 to initialize a display before calling VOXEL_PROJ as shown in the following
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889901">
    Examples
   </a>
   section.
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889827">
   </a>
   <a name="dg_routines_3604229493_677304_PageTOC_VOXEL_PROJ_">
   </a>
   Syntax
  </h2>
  <p class="Syntax">
   <i>
    Result
   </i>
   = VOXEL_PROJ(
   <i>
    V
   </i>
   [,&#160;
   <i>
    RGBO
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889871">
    BACKGROUND
   </a>
   =
   <i>
    array
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889874">
    CUTTING_PLANE
   </a>
   =
   <i>
    array
   </i>
   ] [,&#160;/
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889880">
    INTERPOLATE
   </a>
   ] [,&#160;/
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889883">
    MAXIMUM_INTENSITY
   </a>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889886">
    STEP
   </a>
   =
   <i>
    [Sx
   </i>
   ,
   <i>
    Sy
   </i>
   ,
   <i>
    Sz]
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889889">
    XSIZE
   </a>
   =
   <i>
    pixels
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889892">
    YSIZE
   </a>
   =
   <i>
    pixels
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889895">
    ZBUFFER
   </a>
   =
   <i>
    int_array
   </i>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#dg_routines_3604229493_889898">
    ZPIXELS
   </a>
   =
   <i>
    byte_array
   </i>
   ] )
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889857">
   </a>
   <a name="dg_routines_3604229493_99811">
   </a>
   Return Value
  </h2>
  <p>
   Returns the specified voxel projection results.
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889860">
   </a>
   <a name="dg_routines_3604229493_680844_PageTOC_VOXEL_PROJ_">
   </a>
   Arguments
  </h2>
  <h3 class="Argument">
   V
  </h3>
  <p>
   A three-dimensional array containing the volume to be rendered. This array is converted to byte type if necessary.
  </p>
  <h3 class="Argument">
   RGBO
  </h3>
  <p>
   This optional parameter is used to specify the look-up tables that indicate the color and opacity of each voxel value. This argument can be one of the following types:
  </p>
  <p class="Bullet">
   A (256, 4) byte array for TrueColor rendering. This array represents 256 sets of red, green, blue, and opacity (RGBO) components for each voxel value, scaled into the range of bytes (0 to 255). The R, G, and B components should already be scaled by the opacity. For example, if a voxel value of 100 contains a material that is red, and 35% opaque, the RGBO values should be, respectively: [89, 0, 0, 89] because 255 * 0.35 = 89. If more than one material is present, the RGBO arrays contain the sum of the individual RGBO arrays. The content and shape of the RGBO curves is highly dependent upon the volume data and experimentation is often required to obtain the best display.
  </p>
  <p class="Bullet">
   A (256, 2) byte array for volumes with only one material or monochrome rendering. This array represents 256 sets of pixel values and their corresponding opacities for each voxel value.
  </p>
  <p class="Bullet">
   If this argument is omitted, the average projection method, or maximum intensity method (if the MAXIMUM_INTENSITY keyword is set) is used.
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889869">
   </a>
   <a name="dg_routines_3604229493_677309_PageTOC_VOXEL_PROJ_">
   </a>
   Keywords
  </h2>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889871">
   </a>
   <a name="dg_routines_3604229493_677308_Keywords_VOXEL_PROJ__">
   </a>
   BACKGROUND
  </h3>
  <p>
   A one- or three-element array containing the background color indices. The default is (0,0,0), yielding a black background with most color tables.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889874">
   </a>
   <a name="dg_routines_3604229493_680823_Keywords_VOXEL_PROJ__">
   </a>
   CUTTING_PLANE
  </h3>
  <p>
   A floating-point array specifying the coefficients of additional cutting planes. The array has dimensions of (4, N), where N is the number of additional cutting planes from 1 to 6. Cutting planes are constraints in the form of:
  </p>
  <p class="indent">
   C[0] * X + C[1] * Y + C[2] * Z + D &gt; 0
  </p>
  <p>
   The X, Y, and Z coordinates are specified in voxel coordinates. For example, to specify a cutting plane that excludes all voxels with an X value greater than 10:
  </p>
  <p class="indent">
   CUTTING_PLANE = [-1.0, 0, 0, 10.], for the constraint: -X + 10 &gt; 0.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889880">
   </a>
   <a name="dg_routines_3604229493_680824_Keywords_VOXEL_PROJ__">
   </a>
   INTERPOLATE
  </h3>
  <p>
   Set this keyword to use tri-linear interpolation to determine the data value for each step on a ray. Otherwise, the nearest-neighbor method is used. Setting this keyword improves the quality of images produced, especially when the volume has low resolution in relation to the size of the viewing plane, at the cost of more computing time.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889883">
   </a>
   <a name="dg_routines_3604229493_680825_Keywords_VOXEL_PROJ__">
   </a>
   MAXIMUM_INTENSITY
  </h3>
  <p>
   Set this keyword to make the value of each pixel in the viewing plane the maximum data value along the corresponding ray. The
   <i>
    RGBO
   </i>
   argument is ignored if present.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889886">
   </a>
   <a name="dg_routines_3604229493_680826_Keywords_VOXEL_PROJ__">
   </a>
   STEP
  </h3>
  <p>
   Set this keyword to a three-element vector, [
   <i>
    Sx
   </i>
   ,
   <i>
    Sy
   </i>
   ,
   <i>
    Sz
   </i>
   ], that controls the resolution of the resulting projection. The first two elements contain the step size in the X and Y view plane, in pixels. The third element is the sampling step size in the Z direction, given in voxels.
   <i>
    Sx
   </i>
   and
   <i>
    Sy
   </i>
   must be integers equal to or greater than one, while
   <i>
    Sz
   </i>
   can contain a fractional part. If
   <i>
    Sx
   </i>
   or
   <i>
    Sy
   </i>
   are greater than one, the values of intermediate pixels in the output image are linearly interpolated. Higher step sizes require less time because fewer rays are cast, at the expense of lower resolution in the output image.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889889">
   </a>
   <a name="dg_routines_3604229493_680827_Keywords_VOXEL_PROJ__">
   </a>
   XSIZE
  </h3>
  <p>
   The width, in pixels, of the output image. If this keyword is omitted, the output image is as wide as the currently-selected output device.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889892">
   </a>
   <a name="dg_routines_3604229493_680828_Keywords_VOXEL_PROJ__">
   </a>
   YSIZE
  </h3>
  <p>
   The height, in pixels, of the output image. If this keyword is omitted, the output image is as tall as the currently selected output device.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889895">
   </a>
   <a name="dg_routines_3604229493_680829_Keywords_VOXEL_PROJ__">
   </a>
   ZBUFFER
  </h3>
  <p>
   An integer array, with the same width and height as the output image, that contains the depth portion of the Z-buffer. Include this parameter to combine the previously-read contents of a Z-buffer with a voxel rendering. See the second example, below, for details.
  </p>
  <h3 class="Keyword">
   <a name="dg_routines_3604229493_889898">
   </a>
   <a name="dg_routines_3604229493_680830_Keywords_VOXEL_PROJ__">
   </a>
   ZPIXELS
  </h3>
  <p>
   A byte array, with the same width and height as the output image, that contains the image portion of the Z-buffer. Include this parameter to combine the contents of a Z-buffer with a voxel rendering. See the second example, below, for details.
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889901">
   </a>
   <a name="dg_routines_3604229493_680832_PageTOC_VOXEL_PROJ_">
   </a>
   Examples
  </h2>
  <p>
   The following examples use a volume data set depicting a human head. Execute the following statements to load the data and set appropriate parameters
   <i>
    before
   </i>
   executing the examples below:
  </p>
  <p class="Code">
   ; Read some volume data
   <br />
   file = FILEPATH('head.dat', SUBDIRECTORY = ['examples', 'data'])
   <br />
   V = READ_BINARY(file, DATA_DIMS = [80, 100, 57])
   <br />
   Vx=80 &amp; Vy=100 &amp; Vz=57
   <br />
   <br />
   ; Get device parameters
   <br />
   DEVICE, GET_DECOMPOSED=old_decomposed
   <br />
   old_device=!D.name
   <br />
   resolution=[!D.x_size, !D.y_size]
   <br />
   <br />
   ; Set up the axis scaling and default rotation:
   <br />
   SCALE3, XRANGE=[0, Vx-1], YRANGE=[0, Vy-1], ZRANGE=[0, Vz-1]
  </p>
  <h3>
   <a name="dg_routines_3604229493_889905">
   </a>
   <a name="dg_routines_3604229493_680876_Keywords_VOXEL_PROJ__">
   </a>
   Example 1
  </h3>
  <p>
   In the following example, assume that variable
   <span class="Courier">
    V
   </span>
   contains a volume of data, with dimensions
   <span class="Courier">
    Vx
   </span>
   by
   <span class="Courier">
    Vy
   </span>
   by
   <span class="Courier">
    Vz
   </span>
   . (These variables are created by the code above.) The volume contains two materials, muscle tissue represented by a voxel range of 50 to 70, that we want to render with red color, and an opacity of 20; and bone tissue represented by a voxel range of 190-232, which we want to render with white color, and an opacity of 50:
  </p>
  <p class="Code">
   ; Use a color table
   <br />
   DEVICE, DECOMPOSED=0
   <br />
   <br />
   ; Create the opacity vector:
   <br />
   rgbo = BYTARR(256,4)
   <br />
   <br />
   ; Red and opacity for muscle:
   <br />
   rgbo[50:70, [0,3]] = 20
   <br />
   <br />
   ; White and opacity for bone:
   <br />
   rgbo[190:232, *] = 50
   <br />
   <br />
   ; Compute projected image:
   <br />
   img = VOXEL_PROJ(V, rgbo)
   <br />
   <br />
   ; Convert from 24-bit to 8-bit image and display:
   <br />
   img = COLOR_QUAN(img, 3, R, G, B)
   <br />
   <br />
   ; Load quantized color tables:
   <br />
   TVLCT, R, G, B
   <br />
   <br />
   ; Display the image
   <br />
   TV, img
   <br />
   <br />
   ; Restore device settings
   <br />
   DEVICE, DECOMPOSED=old_decomposed
  </p>
  <h3>
   <a name="dg_routines_3604229493_889909">
   </a>
   <a name="dg_routines_3604229493_680853_Keywords_VOXEL_PROJ__">
   </a>
   Example 2
  </h3>
  <p>
   This example demonstrates combining a volume with the contents of the Z-buffer.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   You must execute Example 1 before executing this example.
  </p>
  <p class="Code">
   ; Use a color table
   <br />
   DEVICE, DECOMPOSED=0
   <br />
   <br />
   ; Set plotting to Z-buffer and set resolution
   <br />
   SET_PLOT, 'Z'
   <br />
   DEVICE, SET_RESOLUTION=resolution
   <br />
   <br />
   ; Draw a polygon at z equal to half the depth:
   <br />
   POLYFILL, [0, Vx-1, Vx-1, 0], [0, 0, Vy-1, Vy-1], Vz/2., /T3D
   <br />
   <br />
   ; Read pixel values from the Z-buffer:
   <br />
   zpix = TVRD()
   <br />
   <br />
   ; Read depth values from the Z-buffer:
   <br />
   zbuff = TVRD(CHANNEL=1)
   <br />
   <br />
   ; Restore plotting to original device:
   <br />
   SET_PLOT, old_device
   <br />
   <br />
   ; Compute the voxel projection and use the ZPIXELS and ZBUFFER
   <br />
   ; keywords to combine the volume with the previously-read contents
   <br />
   ; of the Z-buffer:
   <br />
   img = VOXEL_PROJ(V, rgbo, ZPIXELS=zpix, ZBUFFER=zbuff)
   <br />
   <br />
   ; Convert from 24-bit to 8-bit image.
   <br />
   img = COLOR_QUAN(img, 3, R, G, B)
   <br />
   <br />
   ; Load the quantized color tables:
   <br />
   TVLCT, R, G, B
   <br />
   <br />
   ; Display the image
   <br />
   TV, img
   <br />
   <br />
   ; Restore device settings
   <br />
   DEVICE, DECOMPOSED=old_decomposed
  </p>
  <h3>
   <a name="dg_routines_3604229493_889913">
   </a>
   Example 3
  </h3>
  <p>
   When viewing a volume with only one constituent, the RGBO array should contain only an intensity/opacity value pair. To illustrate, if in Example 1 above, only muscle was of interest we would create the RGBO array as follows.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   You must execute Example 1 before executing this example.
  </p>
  <p class="Code">
   ; Use a color table
   <br />
   DEVICE, DECOMPOSED=0
   <br />
   <br />
   ; Create an empty 256 x 2 array:
   <br />
   rgbo2 = BYTARR(256,2)
   <br />
   <br />
   ; Intensity and opacity for muscle:
   <br />
   rgbo2[50:70, *] = 20
   <br />
   <br />
   ; Compute and display the projected image:
   <br />
   img = VOXEL_PROJ(V, rgbo2)
   <br />
   <br />
   ; Create color table array for red:
   <br />
   RGB = (FINDGEN(256)/255.) # [255., 0., 0]
   <br />
   <br />
   ; Load colors:
   <br />
   TVLCT, RGB[*,0], RGB[*,1], RGB[*,2]
   <br />
   <br />
   ; Display the image
   <br />
   TV, img
   <br />
   <br />
   ; Restore device settings
   <br />
   DEVICE, DECOMPOSED=old_decomposed
  </p>
  <h2 class="API">
   <a name="dg_routines_3604229493_889918">
   </a>
   <a name="dg_routines_3604229493_820515_PageTOC_VOXEL_PROJ_">
   </a>
   Version History
  </h2>
  <table style="width: 499px;caption-side: top;mc-table-style: url('../../Resources/TableStyles/VersionTable.css');" cellspacing="0" class="TableStyle_VersionTable">
   <col width="91px" />
   <col width="408px" />
   <tbody>
    <tr>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColSep">
      <p>
       Pre-4.0
      </p>
     </td>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColEnd">
      <p>
       Introduced
      </p>
     </td>
    </tr>
   </tbody>
  </table>
  <h2 class="API">
   <a name="dg_routines_3604229493_889926">
   </a>
   <a name="dg_routines_3604229493_958775_PageTOC_VOXEL_PROJ_">
   </a>
   See Also
  </h2>
  <p>
   <a class="MCXref_Heading_0" href="../P/POLYSHADE_Procedure.html#dg_routines_3604229493_892899">
    POLYSHADE
   </a>
   ,
   <a class="MCXref_Heading_0" href="../P/PROJECT_VOL_Procedure.html#dg_routines_3604229493_878002">
    PROJECT_VOL Procedure
   </a>
   ,
   <a href="../R/RECON3.html">
    RECON3
   </a>
   ,
   <a class="MCXref_Heading_0" href="../S/SHADE_VOLUME_Procedure.html#dg_routines_3604229493_885531">
    SHADE_VOLUME Procedure
   </a>
  </p>
  <div class="mp_footer">
   Copyright ©
   <span class="DocumentTitleCopyrightYear">
    2012
   </span>
   <![CDATA[ ]]>
   <span class="DocumentTitleCopyrightCompanyName">
    Exelis Visual Information Solutions, Inc.
   </span>
   All Rights Reserved.
  </div>
  <script type="text/javascript" src="../../SkinSupport/MadCapBodyEnd.js">
  </script>
 </body>
</html>