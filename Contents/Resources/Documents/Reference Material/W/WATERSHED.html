<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:madcap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" madcap:lastblockdepth="2" madcap:lastheight="135.6667" madcap:lastwidth="592" madcap:disablemasterstylesheet="true" madcap:tocpath="Routines (alphabetical)|Routines: W" madcap:medium="non-print" madcap:inpreviewmode="false" madcap:preloadimages="false" madcap:runtimefiletype="Topic" madcap:targettype="WebHelp" lang="en-US" xml:lang="en-US" madcap:pathtohelpsystem="../../../" madcap:helpsystemfilename="idl.xml" madcap:searchtype="Stem">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
   WATERSHED
  </title>
  <link href="../../SkinSupport/MadCap.css" rel="stylesheet" />
  <link href="../../Resources/TableStyles/VersionTable.css" rel="stylesheet" />
  <link href="../../Resources/Stylesheets/IDL_style.css" rel="stylesheet" />
  <script src="../../SkinSupport/MadCapAll.js" type="text/javascript">
  </script>
 </head>
 <body>
  <p class="MCWebHelpFramesetLink" style="display: none;">
   <a href="../../../idl_CSH.html#Reference Material/W/WATERSHED.html" style="">
    Open topic with navigation
   </a>
  </p>
  <div class="MCBreadcrumbsBox_0">
   <span class="MCBreadcrumbsPrefix">
    <![CDATA[ ]]>
   </span>
   <a class="MCBreadcrumbsLink" href="../../images/ref_part1.html">
    Routines (alphabetical)
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <a class="MCBreadcrumbsLink" href="W_list.html">
    Routines: W
   </a>
   <span class="MCBreadcrumbsDivider">
    &gt;
   </span>
   <span class="MCBreadcrumbs">
    WATERSHED
   </span>
  </div>
  <h1 class="Routine">
   <a name="W_811389549_959907">
   </a>
   <a name="W_811389549_72089">
   </a>
   WATERSHED
  </h1>
  <p madcap:conditions="Reference Material.Online_Help_Only">
   <madcap:conditionaltext madcap:conditions="Reference Material.Online_Help_Only">
    <a class="MCXref_Heading_0" href="#W_811389549_961164">
     Syntax
    </a>
    |
    <a class="MCXref_Heading_0" href="#W_811389549_961166">
     Return Value
    </a>
    |
    <a class="MCXref_Heading_0" href="#W_811389549_961168">
     Arguments
    </a>
    |
    <a class="MCXref_Heading_0" href="#W_811389549_961171">
     Keywords
    </a>
    |
    <a class="MCXref_Heading_0" href="#W_811389549_961174">
     Examples
    </a>
    |
    <a class="MCXref_Heading_0" href="#W_811389549_983377">
     Version History
    </a>
   </madcap:conditionaltext>
  </p>
  <p>
   The
   <a name="kanchor2687">
   </a>
   WATERSHED function applies the morphological watershed operator to a grayscale image. This operator segments images into watershed regions and their boundaries. Considering the gray scale image as a surface, each local minimum can be thought of as the point to which water falling on the surrounding region drains. The boundaries of the watersheds lie on the tops of the ridges. This operator labels each watershed region with a unique index, and sets the boundaries to zero.
  </p>
  <p>
   Typically, morphological gradients, or images containing extracted edges are used for input to the watershed operator. Noise and small unimportant fluctuations in the original image can produce spurious minima in the gradients, which leads to oversegmentation. Smoothing, or manually marking the seed points are two approaches to overcoming this problem. For further reading, see Dougherty, “An Introduction to Morphological Image Processing”, SPIE Optical Engineering Press, 1992.
  </p>
  <h2 class="API">
   <a name="W_811389549_961164">
   </a>
   <a name="W_811389549_961164_PageTOC_WATERSHED_">
   </a>
   Syntax
  </h2>
  <p class="Syntax">
   <i>
    Result
   </i>
   = WATERSHED (
   <i>
    Image
   </i>
   [,&#160;
   <a class="MCXref_Heading_0" href="#W_811389549_961172">
    CONNECTIVITY
   </a>
   ={4&#160;|&#160;8}&#160;] [,&#160;/
   <a class="MCXref_Heading_0" href="#W_811389549_1049951">
    LONG
   </a>
   ] [,&#160;
   <a class="MCXref_Heading_0" href="#W_811389549_1049960">
    NREGIONS
   </a>
   =
   <i>
    variable
   </i>
   ]&#160;)
  </p>
  <h2 class="API">
   <a name="W_811389549_961166">
   </a>
   <a name="W_811389549_961166_PageTOC_WATERSHED_">
   </a>
   Return Value
  </h2>
  <p>
   Returns an integer array of the same dimensions as the input image. An element of the
   <i>
    Result
   </i>
   array contains the integer identifier of the watershed region in which the corresponding pixel falls, or a zero if the corresponding pixel falls along the separation between regions.
  </p>
  <p class="Note" madcap:autonum="&lt;b&gt;Note: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Note:
     </b>
    </span>
   </span>
   If the LONG keyword is set,
   <i>
    Result
   </i>
   is an array of long integers; otherwise it is an array of short integers. If the LONG keyword is
   <i>
    not
   </i>
   set,
   <i>
    Result
   </i>
   will be clipped to a maximum of 65530 regions. (Regions above 32767 will have negative values; if you have more than 32767 regions you may want to convert your
   <i>
    Result
   </i>
   to unsigned integers using UINT). Use the NREGIONS keyword to determine the actual number of regions.
  </p>
  <h2 class="API">
   <a name="W_811389549_961168">
   </a>
   <a name="W_811389549_961168_PageTOC_WATERSHED_">
   </a>
   Arguments
  </h2>
  <h3 class="Argument">
   Image
  </h3>
  <p>
   The two-dimensional image to be segmented.
   <i>
    Image
   </i>
   is converted to byte type if necessary.
  </p>
  <h2 class="API">
   <a name="W_811389549_961171">
   </a>
   <a name="W_811389549_961171_PageTOC_WATERSHED_">
   </a>
   Keywords
  </h2>
  <h3 class="Keyword">
   <a name="W_811389549_961172">
   </a>
   <a name="W_811389549_961172_Keywords_WATERSHED__">
   </a>
   CONNECTIVITY
  </h3>
  <p>
   Set this keyword to either 4 (to select 4-neighbor connectivity) or 8 (to select 8-neighbor connectivity). Connectivity indicates which pixels in the neighborhood of a given pixel are sampled during the segmentation process. 4-neighbor connectivity samples only the pixels that are immediately adjacent horizontally and vertically. 8-neighbor connectivity samples the diagonally adjacent neighbors in addition to the immediate horizontal and vertical neighbors. The default is 4-neighbor connectivity.
  </p>
  <h3 class="Keyword">
   <a name="W_811389549_1049951">
   </a>
   <a name="W_811389549_1049951_Keywords_WATERSHED_">
   </a>
   LONG
  </h3>
  <p>
   Set this keyword to return an array of long integers, instead of short integers. This keyword is useful if your image contains more than 32766 regions.
  </p>
  <h3 class="Keyword">
   <a name="W_811389549_1049960">
   </a>
   <a name="W_811389549_1049960_Keywords_WATERSHED_">
   </a>
   NREGIONS
  </h3>
  <p>
   Set this keyword to a named variable that will contain the total number of regions within
   <i>
    Image
   </i>
   . In most cases, this will be equal to the maximum value of
   <i>
    Result
   </i>
   .
  </p>
  <p class="Tip" madcap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">
   <span class="autonumber">
    <span>
     <b>
      Tip:
     </b>
    </span>
   </span>
   If the LONG keyword is
   <i>
    not
   </i>
   set, and NREGIONS is greater than 32766, then the
   <i>
    Result
   </i>
   overflowed the maximum. If this occurs, you may wish to re-run WATERSHED with the LONG keyword set.
  </p>
  <h2 class="API">
   <a name="W_811389549_961174">
   </a>
   <a name="W_811389549_961174_PageTOC_WATERSHED_">
   </a>
   Examples
  </h2>
  <p>
   The following code crudely segments the grains in the data file in the IDL Demo data directory containing a magnified image of grains of pollen. Note that the IDL Demos must be installed in order to read the image used in this example.
  </p>
  <p>
   It inverts the image, because the watershed operator finds holes, brightening the grains of pollen. Next, the morphological closing operator is applied with a disc of radius 9, contained within a 19 by 19 kernel, to eliminate holes in the image smaller than the disc. The watershed operator is then applied to segment this image. The borders of the watershed images, which have pixel values of zero, are then merged with the original image and displayed as white.
  </p>
  <p class="Code">
   ; Define the radius of a disc
   <br />
   r = 9
   <br />
   <br />
   ; Create a disc of radius r
   <br />
   disc = SHIFT(DIST(2*r+1), r, r) LE r
   <br />
   <br />
   ; Read the image
   <br />
   READ_JPEG, FILEPATH('pollens.jpg', $
   <br />
   &#160;&#160;&#160;SUBDIR=['examples','demo','demodata']), a
   <br />
   <br />
   ; Invert the image
   <br />
   b = MAX(a) - a
   <br />
   <br />
   TVSCL, b, 0
   <br />
   <br />
   ; Remove holes of radii less than r
   <br />
   c = MORPH_CLOSE(b, disc, /GRAY)
   <br />
   <br />
   TVSCL, c, 1
   <br />
   <br />
   ; Create watershed image
   <br />
   d = WATERSHED(c)
   <br />
   <br />
   ; Display it, showing the watershed regions
   <br />
   TVSCL, d, 2
   <br />
   <br />
   ; Merge original image with boundaries of watershed regions
   <br />
   e = a &gt; (MAX(a) * (d EQ 0b))
   <br />
   <br />
   TVSCL, e, 3
  </p>
  <h2 class="API">
   <a name="W_811389549_983377">
   </a>
   <a name="W_811389549_983377_PageTOC_WATERSHED_">
   </a>
   Version History
  </h2>
  <table style="width: 499px;caption-side: top;mc-table-style: url('../../Resources/TableStyles/VersionTable.css');" cellspacing="0" class="TableStyle_VersionTable">
   <col width="91px" />
   <col width="408px" />
   <tbody>
    <tr>
     <td class="TableStyle_VersionTable_Body_0_0_ColSep">
      <p>
       5.3
      </p>
     </td>
     <td class="TableStyle_VersionTable_Body_0_0_ColEnd">
      <p>
       Introduced
      </p>
     </td>
    </tr>
    <tr>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColSep">
      <p>
       6.1
      </p>
     </td>
     <td class="TableStyle_VersionTable_Body_0_0_RowEnd_ColEnd">
      <p>
       Added LONG and NREGIONS keywords
      </p>
     </td>
    </tr>
   </tbody>
  </table>
  <div class="mp_footer">
   Copyright ©
   <span class="DocumentTitleCopyrightYear">
    2012
   </span>
   <![CDATA[ ]]>
   <span class="DocumentTitleCopyrightCompanyName">
    Exelis Visual Information Solutions, Inc.
   </span>
   All Rights Reserved.
  </div>
  <script type="text/javascript" src="../../SkinSupport/MadCapBodyEnd.js">
  </script>
 </body>
</html>